(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"0myp":function(t,e,i){},"3SfF":function(t,e,i){"use strict";var n=i("0myp");i.n(n).a},L4h3:function(t,e,i){"use strict";i.r(e);var n=i("cLjf"),o=i.n(n),a=i("hDQ3"),s=i.n(a),c=i("Asgo"),l=i.n(c),r=(i("gJGO"),i("iLNi")),d=(i("uErz"),i("ogYY")),p=(i("pbqO"),i("P0vg")),u=(i("ul/Q"),i("8DuP")),h=(i("XkPB"),i("cpGq")),f=i("YicM"),_={name:"script-list",components:{ATable:h.a,AButton:u.a,AUpload:p.a,ATextarea:d.a.TextArea,AInputSearch:d.a.Search,AModal:r.a},data:function(){return{scriptList:f,loading:!0,isEditUpLoadShow:!1,isUpLoadShow:!1,isScriptContent:!1,scriptContent:"",editDescribe:null,describe:"",search_key:null,editFile:null,file:null,edit_script_name:null,script_name:null,pagination:{total:0,current:1,pageSize:10,onChange:this.pageChange},selectedRowKeys:[],data:[],visible:!0,confirmLoading:!1}},methods:{uploadEditScriptConfigAction:function(t){var e=this;this.script_id=t.script_id,this.$fetch.get_script_by_id({script_id:t.script_id}).then(function(t){e.editDescribe=t.describe,e.edit_script_name=t.script_name,e.isEditUpLoadShow=!0})},uploadEditScriptCancelAction:function(){this.isEditUpLoadShow=!1,this.edit_script_name="",this.editFile="",this.editDescribe=""},uploadEditcriptConfigAction:function(){var e=this;if(!this.edit_script_name)return this.$message.error("请上传脚本");this.$fetch.add_script({content:this.editFile,script_id:this.script_id,script_name:this.edit_script_name,describe:this.editDescribe}).then(function(t){e.edit_script_name="",e.editFile="",e.editDescribe="",e.isEditUpLoadShow=!1,e.getList()})},uploadScriptAction:function(){this.isUpLoadShow=!0},uploadScriptCancelAction:function(){this.script_name="",this.file="",this.describe="",this.isUpLoadShow=!1},viewScriptContentAction:function(t){var i=this;this.$fetch.get_script_content({script_id_list:t.script_id.toString()}).then(function(t){i.isScriptContent=!0;var e=t.data;i.scriptContent="<pre><code>"+decodeURIComponent(window.atob(e[0].content))+"<pre><code>"})},editBeforeUpload:function(c){var r=this;return new l.a(function(t,e){var i=c.name,n=c.size;if(i.indexOf(".lua")<0)return r.$message.error("请上传lua文件"),void e();if(!(n/1024/1024<10))return r.$message.error("上传文件不能超过10M"),e();r.edit_script_name=i;var a=new FileReader,s=r;a.onload=function(){a.result&&(s.editFile=a.result)},a.readAsText(c),t()})},beforeUpload:function(c){var r=this;return new l.a(function(t,e){var i=c.name,n=c.size;if(i.indexOf(".lua")<0)return r.$message.error("请上传lua文件"),e();if(!(n/1024/1024<10))return r.$message.error("上传文件不能超过10M"),e();r.script_name=i;var a=new FileReader,s=r;a.onload=function(){a.result&&(s.file=window.btoa(encodeURIComponent(a.result)))},a.readAsText(c),t()})},uploadScriptConfigAction:function(){var e=this;if(!this.script_name)return this.$message.error("请上传脚本");this.isUpLoadShow=!1,this.$fetch.add_script({content:this.file,script_name:this.script_name,describe:this.describe}).then(function(t){e.script_name="",e.file="",e.describe="",e.getList()})},contentScriptCancelAction:function(){this.isScriptContent=!1,this.scriptContent=""},deleteScriptAction:function(t){var e=this;this.$confirm({title:"删除脚本",okText:"确定",cancelText:"取消",content:"您确定要删除该脚本吗",onOk:function(){e.$fetch.delete_script({script_id:t.script_id}).then(function(t){e.getList()})},onCancel:function(){}})},onSearch:function(){this.getList()},pageChange:function(t){this.pagination.current=t,this.getList()},getList:function(){var r=this;return s()(o.a.mark(function t(){var e,i,n,a,s,c;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.loading=!0,e=r.pagination,i=e.current,n=e.pageSize,t.next=4,r.$storage.get("admin_user_info");case 4:a=t.sent,s=a.user_id,c={user_id:s,page_no:i,length:n,search_key:r.search_key},r.$fetch.query_script(c).then(function(t){var e=t.data_0,i=t.data_1;r.data=e||[],r.pagination.total=i?i.count:0,r.loading=!1}).catch(function(){r.loading=!1});case 8:case"end":return t.stop()}},t,r)}))()},onSelectChange:function(t){this.selectedRowKeys=t}},created:function(){this.getList()}},m=(i("3SfF"),i("ZpG+")),g=Object(m.a)(_,function(){var i=this,t=i.$createElement,n=i._self._c||t;return n("div",{staticClass:"script-list"},[n("div",{staticClass:"script-list-header"},[n("a-input-search",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入脚本名称/备注"},on:{search:i.onSearch},model:{value:i.search_key,callback:function(t){i.search_key=t},expression:"search_key"}}),n("a-button",{attrs:{type:"primary"},on:{click:i.uploadScriptAction}},[i._v("上传脚本")])],1),n("div",{staticClass:"script-list-content"},[n("a-table",{attrs:{columns:i.scriptList,rowKey:"script_id",dataSource:i.data,pagination:i.pagination,loading:i.loading},scopedSlots:i._u([{key:"action",fn:function(t,e){return[n("a-button",{on:{click:function(){return i.viewScriptContentAction(e)}}},[i._v("查看")]),n("a-button",{attrs:{type:"primary"},on:{click:function(){return i.uploadEditScriptConfigAction(e)}}},[i._v("编辑")]),n("a-button",{attrs:{type:"danger"},on:{click:function(){return i.deleteScriptAction(e)}}},[i._v("删除")])]}}])})],1),n("a-modal",{staticClass:"script-list-dialog",attrs:{title:"上传脚本",visible:i.isUpLoadShow},on:{cancel:i.uploadScriptCancelAction}},[n("template",{slot:"footer"},[n("a-button",{on:{click:i.uploadScriptCancelAction}},[i._v("取消")]),n("a-button",{attrs:{type:"primary"},on:{click:i.uploadScriptConfigAction}},[i._v("确定")])],1),n("a-form",[n("div",{staticClass:"dialog-content"},[n("div",{staticClass:"content-inner"},[n("span",{staticClass:"label-inner label-inner-first"},[i._v("内容")]),n("a-upload",{ref:"uploads",attrs:{name:"file",action:"123",showUploadList:!1,beforeUpload:i.beforeUpload}},[n("a-button",{attrs:{type:"primary"}},[i._v("上传脚本代码")])],1)],1),i.script_name?n("a-alert",{staticClass:"a-alert-add",attrs:{message:i.script_name,type:"success",showIcon:!0}}):i._e(),n("div",{staticClass:"content-inner content-inner-top"},[n("span",{staticClass:"label-inner"},[i._v("备注")]),n("a-textarea",{staticClass:"e-textarea",attrs:{placeholder:"请输入备注",rows:4},model:{value:i.describe,callback:function(t){i.describe=t},expression:"describe"}})],1)],1)])],2),n("a-modal",{staticClass:"script-list-dialog",attrs:{title:"编辑脚本",visible:i.isEditUpLoadShow},on:{cancel:i.uploadEditScriptCancelAction}},[n("template",{slot:"footer"},[n("a-button",{on:{click:i.uploadEditScriptCancelAction}},[i._v("取消")]),n("a-button",{attrs:{type:"primary"},on:{click:i.uploadEditcriptConfigAction}},[i._v("确定")])],1),n("a-form",[n("div",{staticClass:"dialog-content"},[n("div",{staticClass:"content-inner"},[n("span",{staticClass:"label-inner label-inner-first"},[i._v("内容")]),n("a-upload",{ref:"uploads",attrs:{name:"file",action:"123",showUploadList:!1,beforeUpload:i.editBeforeUpload}},[n("a-button",{attrs:{type:"primary"}},[i._v("脚本代码")])],1)],1),i.edit_script_name?n("a-alert",{staticClass:"a-alert-add",attrs:{message:i.edit_script_name,type:"success",showIcon:!0}}):i._e(),n("div",{staticClass:"content-inner content-inner-top"},[n("span",{staticClass:"label-inner"},[i._v("备注")]),n("a-textarea",{staticClass:"e-textarea",attrs:{placeholder:"请输入备注信息",rows:4},model:{value:i.editDescribe,callback:function(t){i.editDescribe=t},expression:"editDescribe"}})],1)],1)])],2),n("a-modal",{attrs:{title:"脚本内容",width:"70%",visible:i.isScriptContent},on:{cancel:i.contentScriptCancelAction}},[n("template",{slot:"footer"},[n("a-button",{on:{click:i.contentScriptCancelAction}},[i._v("取消")])],1),n("div",{staticClass:"dialog-content dialog-content-hight"},[n("div",{directives:[{name:"highlight",rawName:"v-highlight",value:!0,expression:"true"}],domProps:{innerHTML:i._s(i.scriptContent)}})])],2)],1)},[],!1,null,null,null);e.default=g.exports},YicM:function(t){t.exports=JSON.parse('[{"key":"script_name","title":"脚本名称","dataIndex":"script_name"},{"key":"length","title":"长度","dataIndex":"length"},{"key":"md5","title":"md5","dataIndex":"md5"},{"key":"updated_time","title":"修改时间","dataIndex":"updated_time"},{"key":"describe","title":"备注","dataIndex":"describe"},{"key":"action","title":"操作","dataIndex":"action","scopedSlots":{"customRender":"action"}}]')}}]);